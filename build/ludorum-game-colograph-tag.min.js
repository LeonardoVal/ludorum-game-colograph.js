//! ludorum-game-colograph 0.1.1

(function(a){"use strict";this["ludorum-game-colograph"]=a(this.base,this.Sermat,this.ludorum)}).call(this,function a(b,c,d){"use strict";var e=b.declare,f=b.obj,g=(b.copy,b.raise,b.raiseIf),h=b.Iterable,i=b.iterable,j=d.Game,k=(d.players.UserInterface,{__package__:"ludorum-game-colograph",__name__:"ludorum_game_colograph",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}}),l=k.Colograph=e(j,{name:"Colograph",constructor:function(a){j.call(this,a?a.activePlayer:void 0),b.initialize(this,a).object("colours",{defaultValue:{}}).array("edges",{defaultValue:[[1,3],[2],[3],[]]}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).number("scoreSameShape",{defaultValue:-1,coerce:!0}).number("scoreDifferentShape",{defaultValue:-1,coerce:!0})},players:["Red","Blue"],score:function(){var a={},b=this.shapes,c=this.colours,d=this.scoreSameShape,e=this.scoreDifferentShape,f=this.edges.length;return this.players.forEach(function(b){a[b]=f}),i(this.edges).forEach(function(f,g){f.forEach(function(f){var h=g+","+f;c.hasOwnProperty(h)&&(a[c[h]]+=b[g]===b[f]?d:e)})}),a},result:function(){if(this.moves())return null;var a=this.score(),b=this.players;return this.zerosumResult(a[b[0]]-a[b[1]],b[0])},moves:function(){for(var a=this.colours,b=[],c=0,d=this.edges.length;c<d;c++)a.hasOwnProperty(c)||b.push(c);return b.length<1?null:f(this.activePlayer(),b)},next:function(a,b,c){g(b,"Haps are not required (given ",b,")!");var d=this.activePlayer(),e=0|a[d];g(e<0||e>=this.edges.length,"Invalid move: node ",e," does not exist in ",this,"."),g(this.colours.hasOwnProperty(e),"Invalid move: node ",e," has already been coloured in ",this,".");var h=Object.assign(f(e,d),this.colours);this.edges[e].forEach(function(a){h[a]===d&&(h[e+","+a]=d)}),this.edges.forEach(function(a,b){b!==e&&a.indexOf(e)>=0&&h[b]===d&&(h[b+","+e]=d)});var i={activePlayer:this.opponent(d),colours:h,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape};return c?(this.constructor(i),this):new this.constructor(i)},"static __SERMAT__":{identifier:"Colograph",serializer:function(a){return[{activePlayer:a.activePlayer(),colours:a.colours,edges:a.edges,shapes:a.shapes,scoreSameShape:a.scoreSameShape,scoreDifferentShape:a.scoreDifferentShape}]}},edgeColour:function(a,b){var c=this.edges[a].indexOf(b)>=0||this.edges[b].indexOf(a)>=0,d=this.colours[a],e=this.colours[b];return c&&d>=0&&d===e?d:-1},"static randomGraph":function(a,b,c){a=Math.max(2,+a>>0),b=Math.max(a-1,+b>>0);for(var d,e,f=h.range(a-1).map(function(b){return c.split(1,h.range(b+1,a).toArray())}).toArray(),g=b-(a-1);g>0;g--)d=c.choice(f),d[1].length>0&&(e=c.split(1,d[1]),d[0].push(e[0][0]),d[1]=e[1],g--);return f=f.map(function(a){return a[0]}),f.push([]),f},"static randomGame":function(a){return a=b.initialize({},a).object("random",{defaultValue:b.Randomness.DEFAULT}).integer("nodeCount",{defaultValue:8,coerce:!0}).integer("edgeCount",{defaultValue:11,coerce:!0}).integer("shapeCount",{defaultValue:4,coerce:!0,minimum:1,maximum:4}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).subject,new this({edges:this.randomGraph(a.nodeCount,a.edgeCount,a.random),shapes:a.random.randoms(a.nodeCount,0,a.shapeCount).map(function(b){return a.shapes[0|b]}),scoreSameShape:1})}});return d.games.Colograph=l,l.__SERMAT__.identifier=k.__package__+"."+l.__SERMAT__.identifier,k.__SERMAT__.include.push(l),c.include(k),Object.assign(l.prototype,{circularArrangement:function(a){a=a||200;var b=2*Math.PI/this.edges.length;return this.edges.map(function(c,d){return[Math.round(a*Math.cos(b*d)),Math.round(a*Math.sin(b*d))]})},gridArrangement:function(a,b,c,d){a=a||400,b=b||400;var e=this.edges.length;d||(c||(c=Math.ceil(Math.sqrt(e))),d=Math.ceil(e/c));var f=a/c,g=b/d;return this.edges.map(function(c,e){return[e%d*g-b/2,Math.floor(e/d)*f-a/2]})},playerColour:function(a,b){return b=b||this.playerColours,b&&b[a]||a&&(a+"").toLowerCase()||""},__svgEnvelope__:function(a,b,c){return'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg height="'+b+'px" width="'+a+'px" version="1.1"\nxmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n'+(Array.isArray(c)?c.join("\n\t"):c)+"\n</svg>"},__svgStyles__:function(a){var b=this;return'<style type="text/css" ><![CDATA[\n\t.blank-node { stroke:black; stroke-width:2px; fill:white; }\n\t.blank-node:hover { stroke-width:4px; }\n\t.blank-edge { stroke:black; stroke-width:2px; }\n'+this.players.map(function(c){var d=b.playerColour(c,a);return"\t."+d+"-node { stroke:black; stroke-width:2px; fill:"+d+"}\n\t."+d+"-edge { stroke:"+d+"; stroke-width:2px }"}).join("\n")+"\t]]>\n\t</style>\n"},__svgDefs__:function(a){return a=a||30,["<defs>",this.__svgDefCircle__(a),this.__svgDefSquare__(a),this.__svgDefStar__(a),this.__svgDefTriangle__(a),this.__svgDefPentagon__(a),this.__svgDefHexagon__(a),"</defs>"].join("\n")},__svgDefPolygon__:function(a,b,c){return b=b.map(function(a){return[a[0]*c,a[1]*c]}),'\t<polygon id="'+a+'-node" points="'+b.join(" ")+'"/>'},__svgDefCircle__:function(a){return'\t<circle id="circle-node" r="'+a/2+'px" cx="0" cy="0"/>'},__svgDefSquare__:function(a){return'\t<rect id="square-node" width="'+a+'px" height="'+a+'px" x="-'+a/2+'" y="-'+a/2+'"/>'},__svgDefTriangle__:function(a){return this.__svgDefPolygon__("triangle",[[-.5,.44],[0,-.44],[.5,.44]],a)},__svgDefStar__:function(a){return this.__svgDefPolygon__("star",[[0,-.48],[.12,-.1],[.5,-.1],[.2,.1],[.3,.48],[0,.26],[-.3,.48],[-.2,.1],[-.5,-.1],[-.12,-.1]],a)},__svgDefPentagon__:function(a){return this.__svgDefPolygon__("pentagon",[[0,-.48],[.5,-.1],[.3,.48],[-.3,.48],[-.5,-.1]],a)},__svgDefHexagon__:function(a){return this.__svgDefPolygon__("pentagon",[[0,-.5],[.42,-.24],[.42,.24],[0,.5],[-.42,.24],[-.42,-.24]],a)},toSVG:function(a,b,c,d){a=a||400,b=b||400,d=d||this.gridArrangement(.8*a,.8*b);var e=this,f=this.colours,g=[this.__svgStyles__(),this.__svgDefs__(c),'\t<g id="colograph" transform="translate('+a/2+","+b/2+')">'];this.edges.forEach(function(a,b){var c=d[b];a.forEach(function(a){var h=d[a],i=f[b+","+a],j=(e.playerColour(i)||"blank")+"-edge";g.push('\t<line class="'+j+'" x1="'+c[0]+'" y1="'+c[1]+'" x2="'+h[0]+'" y2="'+h[1]+'"/>')})});var h=this.shapes;return this.edges.forEach(function(a,b){var c=d[b],i=f[b],j=(e.playerColour(i)||"blank")+"-node";g.push('<use id="node'+b+'" xlink:href="#'+h[b]+'-node" transform="translate('+c.join(",")+')" class="'+j+'" data-ludorum-move="'+b+'"/>')}),g.push("\t</g>"),this.__svgEnvelope__(a,b,g)}}),l.heuristics={scoreDifference:function(a,b){var c=a.score(),d=0;for(var e in c)d+=e===b?c[e]:-c[e];return d/a.edges.length/2}},k});
//# sourceMappingURL=ludorum-game-colograph-tag.min.js.map