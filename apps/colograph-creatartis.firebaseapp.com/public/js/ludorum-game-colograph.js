//! ludorum-game-colograph 0.1.1

(function(e){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],e):"object"==typeof exports&&module.exports?module.exports=e(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-game-colograph"]=e(this.base,this.Sermat,this.ludorum)}).call(this,function e(t,r,n){"use strict";var s=t.declare,o=t.obj,a=(t.copy,t.raise,t.raiseIf),i=t.Iterable,u=t.iterable,h=n.Game,c=(n.players.UserInterface,{__package__:"ludorum-game-colograph",__name__:"ludorum_game_colograph",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}}),l=c.Colograph=s(h,{name:"Colograph",constructor:function(e){h.call(this,e?e.activePlayer:void 0),t.initialize(this,e).object("colours",{defaultValue:{}}).array("edges",{defaultValue:[[1,3],[2],[3],[]]}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).number("scoreSameShape",{defaultValue:-1,coerce:!0}).number("scoreDifferentShape",{defaultValue:-1,coerce:!0})},players:["Red","Blue"],score:function(){var e={},t=this.shapes,r=this.colours,n=this.scoreSameShape,s=this.scoreDifferentShape,o=this.edges.length;return this.players.forEach(function(t){e[t]=o}),u(this.edges).forEach(function(o,a){o.forEach(function(o){var i=a+","+o;r.hasOwnProperty(i)&&(e[r[i]]+=t[a]===t[o]?n:s)})}),e},result:function(){if(this.moves())return null;var e=this.score(),t=this.players;return this.zerosumResult(e[t[0]]-e[t[1]],t[0])},moves:function(){for(var e=this.colours,t=[],r=0,n=this.edges.length;r<n;r++)e.hasOwnProperty(r)||t.push(r);return t.length<1?null:o(this.activePlayer(),t)},next:function(e,t,r){a(t,"Haps are not required (given ",t,")!");var n=this.activePlayer(),s=0|e[n];a(s<0||s>=this.edges.length,"Invalid move: node ",s," does not exist in ",this,"."),a(this.colours.hasOwnProperty(s),"Invalid move: node ",s," has already been coloured in ",this,".");var i=Object.assign(o(s,n),this.colours);this.edges[s].forEach(function(e){i[e]===n&&(i[s+","+e]=n)}),this.edges.forEach(function(e,t){t!==s&&e.indexOf(s)>=0&&i[t]===n&&(i[t+","+s]=n)});var u={activePlayer:this.opponent(n),colours:i,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape};return r?(this.constructor(u),this):new this.constructor(u)},"static __SERMAT__":{identifier:"Colograph",serializer:function(e){return[{activePlayer:e.activePlayer(),colours:e.colours,edges:e.edges,shapes:e.shapes,scoreSameShape:e.scoreSameShape,scoreDifferentShape:e.scoreDifferentShape}]}},edgeColour:function(e,t){var r=this.edges[e].indexOf(t)>=0||this.edges[t].indexOf(e)>=0,n=this.colours[e],s=this.colours[t];return r&&n>=0&&n===s?n:-1},"static randomGraph":function(e,t,r){e=Math.max(2,+e>>0),t=Math.max(e-1,+t>>0);for(var n,s,o=i.range(e-1).map(function(t){return r.split(1,i.range(t+1,e).toArray())}).toArray(),a=t-(e-1);a>0;a--)(n=r.choice(o))[1].length>0&&(s=r.split(1,n[1]),n[0].push(s[0][0]),n[1]=s[1],a--);return(o=o.map(function(e){return e[0]})).push([]),o},"static randomGame":function(e){return e=t.initialize({},e).object("random",{defaultValue:t.Randomness.DEFAULT}).integer("nodeCount",{defaultValue:8,coerce:!0}).integer("edgeCount",{defaultValue:11,coerce:!0}).integer("shapeCount",{defaultValue:4,coerce:!0,minimum:1,maximum:4}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).subject,new this({edges:this.randomGraph(e.nodeCount,e.edgeCount,e.random),shapes:e.random.randoms(e.nodeCount,0,e.shapeCount).map(function(t){return e.shapes[0|t]}),scoreSameShape:1})}});return n.games.Colograph=l,l.__SERMAT__.identifier=c.__package__+"."+l.__SERMAT__.identifier,c.__SERMAT__.include.push(l),r.include(c),Object.assign(l.prototype,{circularArrangement:function(e){e=e||200;var t=2*Math.PI/this.edges.length;return this.edges.map(function(r,n){return[Math.round(e*Math.cos(t*n)),Math.round(e*Math.sin(t*n))]})},gridArrangement:function(e,t,r,n){e=e||400,t=t||400;var s=this.edges.length;n||(r||(r=Math.ceil(Math.sqrt(s))),n=Math.ceil(s/r));var o=e/(r-1),a=t/(n-1);return this.edges.map(function(r,s){return[s%n*a-t/2,Math.floor(s/n)*o-e/2]})},playerColour:function(e,t){return(t=t||this.playerColours)&&t[e]||e&&(e+"").toLowerCase()||""},__svgEnvelope__:function(e,t,r){return'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg height="'+t+'px" width="'+e+'px" version="1.1"\nxmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n'+(Array.isArray(r)?r.join("\n\t"):r)+"\n</svg>"},__svgStyles__:function(e){var t=this;return'<style type="text/css" ><![CDATA[\n\t.blank-node { stroke:black; stroke-width:2px; fill:white; }\n\t.blank-node:hover { stroke-width:4px; }\n\t.blank-edge { stroke:black; stroke-width:2px; }\n'+this.players.map(function(r){var n=t.playerColour(r,e);return"\t."+n+"-node { stroke:black; stroke-width:2px; fill:"+n+"}\n\t."+n+"-edge { stroke:"+n+"; stroke-width:2px }"}).join("\n")+"\t]]>\n\t</style>\n"},__svgDefs__:function(e){return e=e||30,["<defs>",this.__svgDefCircle__(e),this.__svgDefSquare__(e),this.__svgDefStar__(e),this.__svgDefTriangle__(e),this.__svgDefPentagon__(e),this.__svgDefHexagon__(e),"</defs>"].join("\n")},__svgDefPolygon__:function(e,t,r){return'\t<polygon id="'+e+'-node" points="'+(t=t.map(function(e){return[e[0]*r,e[1]*r]})).join(" ")+'"/>'},__svgDefCircle__:function(e){return'\t<circle id="circle-node" r="'+e/2+'px" cx="0" cy="0"/>'},__svgDefSquare__:function(e){return'\t<rect id="square-node" width="'+e+'px" height="'+e+'px" x="-'+e/2+'" y="-'+e/2+'"/>'},__svgDefTriangle__:function(e){return this.__svgDefPolygon__("triangle",[[-.5,.44],[0,-.44],[.5,.44]],e)},__svgDefStar__:function(e){return this.__svgDefPolygon__("star",[[0,-.48],[.12,-.1],[.5,-.1],[.2,.1],[.3,.48],[0,.26],[-.3,.48],[-.2,.1],[-.5,-.1],[-.12,-.1]],e)},__svgDefPentagon__:function(e){return this.__svgDefPolygon__("pentagon",[[0,-.48],[.5,-.1],[.3,.48],[-.3,.48],[-.5,-.1]],e)},__svgDefHexagon__:function(e){return this.__svgDefPolygon__("pentagon",[[0,-.5],[.42,-.24],[.42,.24],[0,.5],[-.42,.24],[-.42,-.24]],e)},toSVG:function(e,t,r,n){e=e||400,t=t||400,n=n||this.gridArrangement(.8*e,.8*t);var s=this,o=this.colours,a=[this.__svgStyles__(),this.__svgDefs__(r),'\t<g id="colograph" transform="translate('+e/2+","+t/2+')">'];this.edges.forEach(function(e,t){var r=n[t];e.forEach(function(e){var i=n[e],u=o[t+","+e],h=(s.playerColour(u)||"blank")+"-edge";a.push('\t<line class="'+h+'" x1="'+r[0]+'" y1="'+r[1]+'" x2="'+i[0]+'" y2="'+i[1]+'"/>')})});var i=this.shapes;return this.edges.forEach(function(e,t){var r=n[t],u=o[t],h=(s.playerColour(u)||"blank")+"-node";a.push('<use id="node'+t+'" xlink:href="#'+i[t]+'-node" transform="translate('+r.join(",")+')" class="'+h+'" data-ludorum-move="'+t+'"/>')}),a.push("\t</g>"),this.__svgEnvelope__(e,t,a)}}),l.heuristics={scoreDifference:function(e,t){var r=e.score(),n=0;for(var s in r)n+=s===t?r[s]:-r[s];return n/e.edges.length/2}},c});
//# sourceMappingURL=ludorum-game-colograph.min.js.map